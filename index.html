<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CareerAI</title>
  <script type="module">
    // ================= FIREBASE AUTH SETUP =================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvy0adQdoosf5a_63QOPsV6X8v8rq66Sc",
      authDomain: "job5x-472810.firebaseapp.com",
      projectId: "job5x-472810",
      storageBucket: "job5x-472810.appspot.com",   // ‚úÖ Fixed here
      messagingSenderId: "927725128020",
      appId: "1:927725128020:web:5ad79c445c0fe8010820c1",
      measurementId: "G-FKT33RHQ9M"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // DOM elements
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const userInfo = document.getElementById("user-info");

    // Login
    loginBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        console.log("User signed in:", user);
      } catch (err) {
        alert("Login failed: " + err.message);
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // Auth state change
    onAuthStateChanged(auth, (user) => {
      if (user) {
        userInfo.innerHTML = `
          <img src="${user.photoURL}" alt="Profile" style="width:40px;height:40px;border-radius:50%">
          <span>${user.displayName}</span>
        `;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
      } else {
        userInfo.innerHTML = `<span>Not logged in</span>`;
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
      }
    });

    // ================= AI RESUME GENERATOR =================
    const resumeForm = document.getElementById("resume-form");
    const resumeOutput = document.getElementById("resume-output");

    resumeForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const details = document.getElementById("details").value;
      const job = document.getElementById("job").value;

      resumeOutput.innerHTML = "‚è≥ Generating resume with AI...";

      try {
        const res = await fetch("/.netlify/functions/resume", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ details, job })
        });

        const data = await res.json();
        resumeOutput.innerHTML = `<pre>${data.text}</pre>`;
      } catch (err) {
        resumeOutput.innerHTML = "‚ùå Error: " + err.message;
      }
    });
  </script>
</head>
<body>
  <header style="display:flex;justify-content:space-between;align-items:center;padding:16px;background:#f4f4f4;">
    <h1>CareerAI üöÄ</h1>
    <div>
      <button id="login-btn">Sign in with Google</button>
      <button id="logout-btn" style="display:none;">Logout</button>
      <span id="user-info"></span>
    </div>
  </header>

  <main style="padding:20px;">
    <h2>AI Resume Builder</h2>
    <form id="resume-form">
      <label>Your Details:</label><br>
      <textarea id="details" rows="5" cols="50" placeholder="Enter your details"></textarea><br><br>
      <label>Target Job:</label><br>
      <input id="job" type="text" placeholder="e.g. Data Scientist" /><br><br>
      <button type="submit">Generate Resume</button>
    </form>
    <div id="resume-output" style="margin-top:20px;padding:10px;border:1px solid #ccc;"></div>
  </main>
</body>
</html>
