
<!doctype html>
<html>
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Resume Maker — CareerAI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .resume-card { width: 210mm; min-height: 297mm; padding: 24px; background: white; }
    .left { background:#0f172a; color:white; padding:20px; min-height:100%; border-radius:8px; }
    .right { padding:20px; }
    .section-title { color:#0f172a; font-weight:700; margin-top:12px; margin-bottom:8px; }
  </style>
</head>
<body class="bg-gray-100">

  <div class="max-w-6xl mx-auto p-6 grid md:grid-cols-3 gap-6">
    <!-- form -->
    <div class="md:col-span-1 bg-white p-6 rounded shadow">
      <h3 class="font-bold mb-4">Build your resume</h3>

      <label class="text-sm">Full name</label>
      <input id="r_name" class="w-full border rounded p-2 mb-2">

      <label class="text-sm">Title (e.g. Data Scientist)</label>
      <input id="r_title" class="w-full border rounded p-2 mb-2">

      <label class="text-sm">Summary / Profile</label>
      <textarea id="r_summary" class="w-full border rounded p-2 mb-2"></textarea>

      <label class="text-sm">Skills (comma separated)</label>
      <input id="r_skills" class="w-full border rounded p-2 mb-2">

      <label class="text-sm">Experience (Title @ Company | Year | Description)</label>
      <textarea id="r_experience" class="w-full border rounded p-2 mb-2"></textarea>

      <label class="text-sm">Education (Degree | School | Year)</label>
      <input id="r_edu" class="w-full border rounded p-2 mb-2">

      <label class="text-sm">Photo (optional)</label>
      <input id="r_photo" type="file" accept="image/*" class="block mb-2">
      <input id="r_photo_url" placeholder="Or paste image URL" class="w-full border rounded p-2 mb-2">

      <button id="generateBtn" class="w-full bg-blue-600 text-white py-2 rounded mb-2">Generate Resume</button>
      <button id="downloadBtn" class="w-full bg-green-600 text-white py-2 rounded mb-2">Export PDF</button>
      <p id="scoreText" class="mt-2 text-sm text-gray-600"></p>
    </div>

    <!-- preview -->
    <div id="previewWrap" class="md:col-span-2">
      <div id="resumePreview" class="resume-card shadow">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-4 left">
            <div id="pv_photo" class="mb-4"></div>
            <h2 id="pv_name" class="text-2xl font-extrabold">Your Name</h2>
            <p id="pv_title" class="text-sm text-gray-200 mb-4">Title</p>

            <h3 class="font-bold text-sm mt-4">Skills</h3>
            <ul id="pv_skills" class="text-sm space-y-1 text-gray-200"></ul>
          </div>

          <div class="col-span-8 right">
            <p id="pv_summary" class="text-gray-800"></p>
            <div id="pv_experiences" class="mt-4"></div>
            <h4 class="section-title">Education</h4>
            <div id="pv_education" class="text-gray-700"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvy0adQdoosf5a_63QOPsV6X8v8rq66Sc",
      authDomain: "job5x-472810.firebaseapp.com",
      projectId: "job5x-472810",
      storageBucket: "job5x-472810.appspot.com",
      messagingSenderId: "927725128020",
      appId: "1:927725128020:web:5ad79c445c0fe8010820c1",
      measurementId: "G-FKT33RHQ9M"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    onAuthStateChanged(auth, (u) => currentUser = u);

    const byId = id => document.getElementById(id);
    const generateBtn = byId('generateBtn');
    const downloadBtn = byId('downloadBtn');

    async function readImageFile(fileInput, urlInput) {
      const file = fileInput.files[0];
      if (file) {
        return new Promise((res, rej) => {
          const reader = new FileReader();
          reader.onload = e => res(e.target.result);
          reader.onerror = rej;
          reader.readAsDataURL(file);
        });
      }
      const url = urlInput.value.trim();
      if (url) return url;
      return null;
    }

    generateBtn.addEventListener('click', async () => {
      const name = byId('r_name').value.trim() || 'Your Name';
      const title = byId('r_title').value.trim() || 'Job Title';
      const summary = byId('r_summary').value.trim() || 'Profile summary...';
      const skills = (byId('r_skills').value || '').split(',').map(s => s.trim()).filter(Boolean);
      const expRaw = (byId('r_experience').value || '').split('\n').filter(Boolean);
      const edu = byId('r_edu').value.trim();
      const photoData = await readImageFile(byId('r_photo'), byId('r_photo_url'));

      // fill preview
      byId('pv_name').textContent = name;
      byId('pv_title').textContent = title;
      byId('pv_summary').textContent = summary;

      const pv_skills = byId('pv_skills'); pv_skills.innerHTML = '';
      skills.forEach(s => pv_skills.insertAdjacentHTML('beforeend', `<li>• ${s}</li>`));

      const pv_experiences = byId('pv_experiences'); pv_experiences.innerHTML = '';
      if (expRaw.length === 0) {
        pv_experiences.innerHTML = `<p class="text-gray-700">No experience listed — add projects or work history.</p>`;
      } else {
        expRaw.forEach(line => {
          const parts = line.split('|').map(p => p.trim());
          const titleCompany = parts[0] || '';
          const years = parts[1] || '';
          const desc = parts[2] || '';
          pv_experiences.insertAdjacentHTML('beforeend', `
            <div class="mb-3">
              <div class="flex justify-between">
                <strong>${titleCompany}</strong>
                <span class="text-sm text-gray-500">${years}</span>
              </div>
              <div class="text-gray-700 text-sm">${desc}</div>
            </div>
          `);
        });
      }

      byId('pv_education').textContent = edu || 'Add your degree/institution';

      const pv_photo = byId('pv_photo');
      pv_photo.innerHTML = '';
      if (photoData) {
        pv_photo.innerHTML = `<img src="${photoData}" class="w-28 h-28 rounded-full object-cover mb-3">`;
      }

      // scoring
      let score = 50;
      if (skills.length >= 3) score += 15;
      if (expRaw.length >= 1) score += 20;
      if (edu) score += 10;
      if (photoData) score += 5;
      if (summary.length > 50) score += 5;
      score = Math.min(95, score);

      byId('scoreText').textContent = `Resume score: ${score}/100`;

      // Save to Firestore if logged in
      if (currentUser) {
        try {
          await addDoc(collection(db, "resumes"), {
            uid: currentUser.uid,
            name, title, summary, skills, experiences: expRaw, education: edu,
            photo: photoData || null,
            score,
            createdAt: serverTimestamp()
          });
          byId('scoreText').textContent += ' — Saved to your account.';
        } catch (e) {
          console.error(e);
          alert('Could not save resume: ' + e.message);
        }
      }
    });

    downloadBtn.addEventListener('click', () => {
      const el = document.getElementById('resumePreview');
      const opt = {
        margin: 0.25,
        filename: 'resume.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(el).save();
    });
  </script>
</body>
</html>
